# name: test/sql/data_inlining/table_stats.test
# description: test ducklake flushing has correct table_stats
# group: [data_inlining]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/table_stats', DATA_INLINING_ROW_LIMIT 10)

statement ok
use ducklake

statement ok
CREATE TABLE t ( a integer )

statement ok
insert into t values (0);

statement ok
insert into t values (1);

statement ok
insert into t values (2);

query II
SELECT table_name, rows_flushed FROM ducklake_flush_inlined_data('ducklake')
----
t	3

query II
SELECT record_count, next_row_id FROM __ducklake_metadata_ducklake.ducklake_table_stats;
----
3	3