# name: test/sql/add_files/add_columns_named_array_element.test
# description: test ducklake adding a parquet file with columns literally named "array" and "element"
# group: [add_files]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__

statement ok
COPY (SELECT 1 as array, 2 as element, [1,2,3] as my_list) TO '${DATA_PATH}/array_element_cols.parquet';

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/add_columns_named_array_element');

statement ok
USE ducklake

statement ok
CREATE TABLE test AS SELECT * FROM read_parquet('${DATA_PATH}/array_element_cols.parquet')
WITH NO DATA;

statement ok
CALL ducklake_add_data_files('ducklake', 'test', '${DATA_PATH}/array_element_cols.parquet')

query III
FROM test;
----
1	2	[1, 2, 3]

query I
SELECT "array" FROM test;
----
1

query I
SELECT "element" FROM test;
----
2

query I
SELECT my_list FROM test;
----
[1, 2, 3]
